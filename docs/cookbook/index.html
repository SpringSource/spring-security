<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Spring Security Cookbook</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring Security Cookbook</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_intended_audiences">1.1. Intended Audiences</a></li>
<li><a href="#_the_recipes">1.2. The Recipes</a></li>
</ul>
</li>
<li><a href="#recipe-basic-auth">2. Recipe: Basic Auth</a>
<ul class="sectlevel2">
<li><a href="#security-cookbook-the-web-application">2.1. The Application to Secure</a></li>
<li><a href="#_securing_the_application">2.2. Securing the Application</a></li>
</ul>
</li>
<li><a href="#recipe-authenticating-with-a-database">3. Recipe: Authenticating with a Database</a></li>
<li><a href="#recipe-securing-an-angular-web-application">4. Recipe: Securing an Angular Web Application</a>
<ul class="sectlevel2">
<li><a href="#angular-create-spring-boot-application">4.1. Create a Spring Boot Application</a></li>
<li><a href="#angular-create-angular-application">4.2. Create an Angular Application</a>
<ul class="sectlevel3">
<li><a href="#angular-customize-angular-application">4.2.1. Customize the Angular Application</a></li>
</ul>
</li>
<li><a href="#angular-adding-dynamic-content">4.3. Adding Dynamic Content</a></li>
<li><a href="#_loading_a_dynamic_resource_with_angular">4.4. Loading a Dynamic Resource with Angular</a></li>
<li><a href="#angular-how-it-works">4.5. How it Works</a></li>
<li><a href="#angular-adding-form-based-login">4.6. Adding Form-based Login</a>
<ul class="sectlevel3">
<li><a href="#_adding_navigation_to_the_home_page">4.6.1. Adding Navigation to the Home Page</a></li>
</ul>
</li>
<li><a href="#_setting_up_the_greeting">4.7. Setting up the Greeting</a></li>
<li><a href="#_setting_up_the_login_form">4.8. Setting up the Login Form</a></li>
<li><a href="#_supporting_the_authentication_process">4.9. Supporting the Authentication Process</a>
<ul class="sectlevel3">
<li><a href="#_submitting_the_login_form">4.9.1. Submitting the Login Form</a></li>
<li><a href="#_adding_the_user_endpoint">4.9.2. Adding the <code>/user</code> Endpoint</a></li>
<li><a href="#_handling_the_login_request_on_the_server">4.9.3. Handling the Login Request on the Server</a></li>
<li><a href="#_adding_default_http_request_headers">4.9.4. Adding Default HTTP Request Headers</a></li>
<li><a href="#_implementing_logout">4.9.5. Implementing Logout</a></li>
<li><a href="#_adding_csrf_protection">4.9.6. Adding CSRF Protection</a></li>
<li><a href="#angular-how-it-works-login-form">4.9.7. How It Works</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#recipe-securing-a-client-application-with-oauth">5. Recipe: Securing a Client Application with OAuth</a>
<ul class="sectlevel2">
<li><a href="#understanding-oauth">5.1. Understanding OAuth</a>
<ul class="sectlevel3">
<li><a href="#_oauth_and_redirect_uris">5.1.1. OAuth and Redirect URIs</a></li>
<li><a href="#_the_client_id_and_the_secret">5.1.2. The Client ID and the Secret</a>
<ul class="sectlevel4">
<li><a href="#_when_to_not_send_secrets">When to Not Send Secrets</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_writing_the_client_application">5.2. Writing the Client Application</a>
<ul class="sectlevel3">
<li><a href="#oauth-adding-a-new-application">5.2.1. Adding a New Application</a>
<ul class="sectlevel4">
<li><a href="#_configuring_the_application_yml">Configuring the <code>application.yml</code></a></li>
<li><a href="#_creating_the_application">Creating the Application</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_oauth_resources">5.3. OAuth Resources</a></li>
</ul>
</li>
<li><a href="#recipe-creating-an-oauth-resource-server">6. Recipe: Creating an OAuth Resource Server</a>
<ul class="sectlevel2">
<li><a href="#_oauth_resources_2">6.1. OAuth Resources</a></li>
<li><a href="#_writing_the_resource_server">6.2. Writing the Resource Server</a></li>
<li><a href="#_running_the_resource_server">6.3. Running the Resource Server</a>
<ul class="sectlevel3">
<li><a href="#_handling_get_requests">6.3.1. Handling GET Requests</a></li>
<li><a href="#_handling_post_requests">6.3.2. Handling POST Requests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This cookbook contains recipes that you can use to configure Spring Security for various scenarios.</p>
</div>
<div class="paragraph">
<p>It starts with simple scenarios and moves to more complex scenarios.</p>
</div>
<div class="sect2">
<h3 id="_intended_audiences">1.1. Intended Audiences</h3>
<div class="paragraph">
<p>This book aims to help both new users of Spring Security and more experienced users who want a quick reference for common tasks.
The book uses links to introductory and explanatory content, to let new users learn those important details while letting experienced users skip over them.
If in doubt, follow the link to more detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_recipes">1.2. The Recipes</h3>
<div class="paragraph">
<p>This cookbook contains the following recipes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#recipe-basic-auth">Recipe: Basic Auth</a></p>
</li>
<li>
<p><a href="#recipe-authenticating-with-a-database">Recipe: Authenticating with a Database</a></p>
</li>
<li>
<p><a href="#recipe-securing-an-angular-web-application">Recipe: Securing an Angular Web Application</a></p>
</li>
<li>
<p><a href="#recipe-securing-a-client-application-with-oauth">Recipe: Securing a Client Application with OAuth</a></p>
</li>
<li>
<p><a href="#recipe-creating-an-oauth-resource-server">Recipe: Creating an OAuth Resource Server</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="recipe-basic-auth">2. Recipe: Basic Auth</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You should not use basic auth for projects other than proofs of concept and demonstrations.
We include it in the cookbook because it lets us show the basic pattern of Spring Security with the fewest additional details.
(In other words, it is the simplest example.)
If you are already familiar with Spring Security, you might want to skip this recipe.
If you are new to Spring Security, this recipe is worth reviewing, to learn the basics.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="security-cookbook-the-web-application">2.1. The Application to Secure</h3>
<div class="paragraph">
<p>Spring Security secures applications, so we need an application to secure.
A simple web application suffices as an example that we can then secure in the various recipes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We use the same example that we used in the &#8220;Securing a Web Application&#8221; guide, which you can find on the Spring web site at <a href="https://spring.io/guides/gs/securing-web/">https://spring.io/guides/gs/securing-web/</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We use Spring Boot with the Spring Web and Thymeleaf dependencies.
There are lots of ways to make a web application, but we know this one well, since we have documented it elsewhere.</p>
</div>
<div class="paragraph">
<p>We start with the build files for both Maven and Gradle (in case you prefer one or the other).
The following listing shows the build file for Maven (<code>pom.xml</code>):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;2.2.0.RELEASE&lt;/version&gt;
		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
	&lt;/parent&gt;
	&lt;groupId&gt;com.example&lt;/groupId&gt;
	&lt;artifactId&gt;securing-web&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
	&lt;name&gt;securing-web&lt;/name&gt;
	&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
			&lt;exclusions&gt;
				&lt;exclusion&gt;
					&lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
					&lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
				&lt;/exclusion&gt;
			&lt;/exclusions&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;

&lt;/project&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following listing shows the build file for Gradle (<code>build.gradle</code>):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">plugins {
	id 'org.springframework.boot' version '2.2.0.RELEASE'
	id 'io.spring.dependency-management' version '1.0.8.RELEASE'
	id 'java'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '1.8'

repositories {
	mavenCentral()
}

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	testImplementation('org.springframework.boot:spring-boot-starter-test') {
		exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
	}
}

test {
	useJUnitPlatform()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>After the build files, we need some HTML files.
We start where a visitor would start, at <code>home.html</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The HTML files go in the <code>resources/templates</code> directory.
Spring Boot knows to look for them in that location.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following listing shows our <code>home.html</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3"&gt;
    &lt;head&gt;
        &lt;title&gt;Spring Security Example&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Welcome!&lt;/h1&gt;

        &lt;p&gt;Click &lt;a th:href="@{/hello}"&gt;here&lt;/a&gt; to see a greeting.&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We also need a <code>hello.html</code> file, so that visitors to our web site can see the greeting we mention in the <code>home.html</code> file.
The following listing shows the <code>home.html</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3"&gt;
    &lt;head&gt;
        &lt;title&gt;Hello, World!&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello, world!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once we have HTML pages for our visitors to see, we need to route them to the pages.
We do that with a class that implements the <code>WebMvcConfigurer</code> (from the Spring framework).
The following listing shows that class, which is called <code>MvcConfig</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.example.securingweb;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class MvcConfig implements WebMvcConfigurer {

    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/home").setViewName("home");
        registry.addViewController("/").setViewName("home");
        registry.addViewController("/hello").setViewName("hello");
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Finally, we need an application class to give us an entry point for our program.
We call it <code>SecuringWebApplication</code>, even though it is not yet secure.
We cover how to secure it in the various recipes.
The following application shows the <code>SecuringWebApplication</code> class:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.example.securingweb;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class SecuringWebApplication {

    public static void main(String[] args) throws Throwable {
        SpringApplication.run(SecuringWebApplication.class, args);
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we run this application now, we would see an unsecured web application.
Now we can make it be a secure application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_securing_the_application">2.2. Securing the Application</h3>
<div class="paragraph">
<p>To secure the simple web application presented in the <a href="#security-cookbook-the-web-application">preceding section</a>, we need to add the appropriate Spring Security dependencies to our build file (we show both Maven and Gradle).</p>
</div>
<div class="paragraph">
<p>For Gradle, we need to add the following two lines to the <code>dependencies</code> block in our <code>build.gradle</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">implementation 'org.springframework.boot:spring-boot-starter-security'
implementation 'org.springframework.security:spring-security-test'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following listing shows the final <code>build.gradle</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">plugins {
	id 'org.springframework.boot' version '2.2.0.RELEASE'
	id 'io.spring.dependency-management' version '1.0.8.RELEASE'
	id 'java'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '1.8'

repositories {
	mavenCentral()
}

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.boot:spring-boot-starter-security'
	implementation 'org.springframework.security:spring-security-test'
	testImplementation('org.springframework.boot:spring-boot-starter-test') {
		exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
	}
}

test {
	useJUnitPlatform()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For Maven, we need to add the following two dependencies to the <code>dependencies</code> element in our <code>pom.xml</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
	&lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
	&lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following listing shows the final <code>pom.xml</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;2.2.0.RELEASE&lt;/version&gt;
		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
	&lt;/parent&gt;
	&lt;groupId&gt;com.example&lt;/groupId&gt;
	&lt;artifactId&gt;securing-web&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
	&lt;name&gt;securing-web&lt;/name&gt;
	&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
			&lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
			&lt;exclusions&gt;
				&lt;exclusion&gt;
					&lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
					&lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
				&lt;/exclusion&gt;
			&lt;/exclusions&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;

&lt;/project&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We also need a login page. The following HTML file serves that need:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3"&gt;
    &lt;head&gt;
        &lt;title&gt;Spring Security Example &lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div th:if="${param.error}"&gt;
            Invalid username and password.
        &lt;/div&gt;
        &lt;div th:if="${param.logout}"&gt;
            You have been logged out.
        &lt;/div&gt;
        &lt;form th:action="@{/login}" method="post"&gt;
            &lt;div&gt;&lt;label&gt; User Name : &lt;input type="text" name="username"/&gt; &lt;/label&gt;&lt;/div&gt;
            &lt;div&gt;&lt;label&gt; Password: &lt;input type="password" name="password"/&gt; &lt;/label&gt;&lt;/div&gt;
            &lt;div&gt;&lt;input type="submit" value="Sign In"/&gt;&lt;/div&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We also need to add a line to our <code>MvcConfig</code> class, as the following listing shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.example.securingweb;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class MvcConfig implements WebMvcConfigurer {

    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/home").setViewName("home");
        registry.addViewController("/").setViewName("home");
        registry.addViewController("/hello").setViewName("hello");
        registry.addViewController("/login").setViewName("login"); <b class="conum">(1)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We need to add this line to make the <code>/login</code> path work.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>We also need a class to configure security for our web application.
The following listing shows that class (called <code>WebSecurityConfig</code>):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.example.securingweb;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;

@Configuration
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests() <b class="conum">(1)</b>
                .antMatchers("/", "/home").permitAll() <b class="conum">(2)</b>
                .anyRequest().authenticated() <b class="conum">(3)</b>
                .and()
            .formLogin() <b class="conum">(4)</b>
                .loginPage("/login") <b class="conum">(5)</b>
                .permitAll()
                .and()
            .logout() <b class="conum">(6)</b>
                .permitAll();
    }

    @Bean
    @Override
    public UserDetailsService userDetailsService() {
        UserDetails user = <b class="conum">(7)</b>
             User.withDefaultPasswordEncoder()
                .username("user") <b class="conum">(8)</b>
                .password("password") <b class="conum">(9)</b>
                .roles("USER") <b class="conum">(10)</b>
                .build(); <b class="conum">(11)</b>

        return new InMemoryUserDetailsManager(user);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Turn on security by authorizing request.</p>
</li>
<li>
<p>Let anyone see the default and <code>home</code> paths.</p>
</li>
<li>
<p>Require that any request be authenticated. (This is where we apply security.)</p>
</li>
<li>
<p>Allow a login form.</p>
</li>
<li>
<p>Allow that form from the <code>/login</code> path.</p>
</li>
<li>
<p>Let anyone see the logout page.</p>
</li>
<li>
<p>Define a user object.</p>
</li>
<li>
<p>The user&#8217;s user name is <code>user</code>.</p>
</li>
<li>
<p>The user&#8217;s user name is <code>password</code>.</p>
</li>
<li>
<p>The user&#8217;s role is <code>USER</code>.</p>
</li>
<li>
<p>Build the user object.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<em>NEVER</em> put user names and passwords in code for a real application.
It is tolerable for demonstrations and samples, but it is very poor practice for real applications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>WebSecurityConfig</code> class has two key parts: A <code>configure</code> method (which overrides the <code>configure</code> method in <code>WebSecurityConfigurerAdapter</code>) and a <code>UserDetailsService</code> bean.
The <code>configure</code> method has a chain of methods that define the security for the paths in our application.
In essence, the preceding configuration says, &#8220;Let anyone see the login and logout pages. Make everyone authenticate (log in) to see anything else.&#8221;
We also define the one and only user who can view our web application.
Normally, we would get user details from a database or an LDAP or OAuth server (or from some other source - many options exist).
We created this simple arrangement to show the basic outline of what happens.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="recipe-authenticating-with-a-database">3. Recipe: Authenticating with a Database</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For this recipe, we secure the application described in the Basic Auth recipe. See <a href="#security-cookbook-the-web-application">The Application to Secure</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One of the most common ways to store user data is in a database.
It is so common that Spring Security even has its own database schema with which it can work.
You can either use the Spring Security schema or create a custom one.
In this example, we use a MySQL database.
You can use many other databases, though.
Spring Security supports many databases, and you can write custom classes to support pretty much any database.</p>
</div>
<div class="paragraph">
<p>For the sake of simplicity, we use the Spring Security schema in this example.
To match the Spring Security schema, we can use the following SQL statements in MySQL&#8217;s command line to create the tables we need:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">create table users(
	username varchar(50) not null primary key,
	password varchar(100) not null,
	enabled boolean not null
);
create table authorities (
	username varchar(50) not null,
	authority varchar(50) not null,
	constraint fk_authorities_users foreign key(username) references users(username)
);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We also need an index, which we can create with the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">create unique index ix_auth_username on authorities (username,authority);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>From there, we can create our user record and set up its authority, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">insert into users(username,password,enabled) values('user','$2a$10$FShxdbQCgfQK/4D5r5siFe8Fx/MJesnji49Tttgk.4ax52mEwNS8y',true);
insert into authorities(username,authority)  values('user','ROLE_USER');</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>What is going on with that password?
We encoded the password (which is <code>password</code>, as it was in the basic auth example <a href="#security-getting-started-basic-authentication">shown earlier</a>) with bcrypt.
The user types <code>password</code>, and <code>BCryptPasswordEncoder</code> turns it into that string for us so that it matches the value in the database.
We cover that a bit later in this section.</p>
</div>
<div class="paragraph">
<p>How did we get that string?
We wrote a simple program that converts the string, <code>password</code>, into a bcrypt value.
The following listing shows that program:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package security.utilities.passwordencoder;

import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

public class PasswordEncoder {

	public static void main(String[] args) {
		String encodedpassword=new BCryptPasswordEncoder().encode("password");
		System.out.println(encodedpassword);
	}

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To get our database to work, we need to set some values in the <code>application properties</code> file (in the <code>resources</code> directory of our application).
The following listing shows those values:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/security?useSSL=false
spring.datasource.username=root
spring.datasource.password=password</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Do NOT set your username to <code>root</code> and your password to <code>password</code> for a real application.
We did it here because this is an example.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get the application to work, we have to add two dependencies: a MySQL connection and Spring Data JDBC.
The following listing shows the new <code>pom.xml</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;2.2.0.RELEASE&lt;/version&gt;
		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
	&lt;/parent&gt;
	&lt;groupId&gt;com.example&lt;/groupId&gt;
	&lt;artifactId&gt;securing-web&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
	&lt;name&gt;securing-web&lt;/name&gt;
	&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt; <b class="conum">(1)</b>
    		&lt;groupId&gt;mysql&lt;/groupId&gt;
    		&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    		&lt;version&gt;5.1.25&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt; <b class="conum">(2)</b>
      		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      		&lt;artifactId&gt;spring-boot-starter-data-jdbc&lt;/artifactId&gt;
    	&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
			&lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
			&lt;exclusions&gt;
				&lt;exclusion&gt;
					&lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
					&lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
				&lt;/exclusion&gt;
			&lt;/exclusions&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;

&lt;/project&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The connector dependency.</p>
</li>
<li>
<p>The Spring Data JDBC dependency.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>We also need substantial changes to our <code>WebSecurityConfig</code> class.
In particular, we can remove the <code>UserDetailsService</code> bean, and we need to add a <code>configure</code> method that uses <code>AuthenticationManagerBuilder</code> as a parameter.
We also need to define a data source (which finds our database).
Note that this method is an override of the <code>configure</code> method in <code>WebSecurityConfigurerAdapter</code>.
The following listing shows our new <code>WebSecurityConfig</code> class:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.example.securingweb;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

@Configuration
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

	@Autowired
	private DataSource dataSource; <b class="conum">(1)</b>

    @Override
    protected void configure(HttpSecurity http) throws Exception {

        http
            .authorizeRequests()
                .antMatchers("/", "/home").permitAll()
                .anyRequest().authenticated()
                .and()
            .formLogin()
                .loginPage("/login")
                .permitAll()
                .and()
            .logout()
                .permitAll();
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception { <b class="conum">(2)</b>

      auth.jdbcAuthentication().dataSource(dataSource)
          .usersByUsernameQuery("select username, password, enabled"
              + " from users where username=?")
          .authoritiesByUsernameQuery("select username, authority "
              + "from authorities where username=?")
          .passwordEncoder(new BCryptPasswordEncoder());
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Autowire the data source.</p>
</li>
<li>
<p>The <code>configure</code> method that has <code>AuthenticationManagerBuilder</code> as a parameter.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>We rely on Spring Boot to find our database (from the information in <code>application.properties</code>), so we need only autowire it here to get it to work.</p>
</div>
<div class="paragraph">
<p>What does that <code>configure(AuthenticationManagerBuilder auth)</code> method do?
The <code>AuthenticationManagerBuilder</code> exposes a method called <code>jdbcAuthentication</code>, which supports chaining other methods to define the user query that we use to see if a user matches the user name and password provided in the HTML form.
The <code>jdbcAuthentication</code> method lets us specify the data source and then add two queries, one for the user and one for the authority.
It also lets us specify the password encoder.
Since we specify <code>BCryptPasswordEncoder</code>, the password provided by the user in the form matches the bcrypt-encoded password that we inserted into the database earlier, so long as the user types <code>password</code>.</p>
</div>
<div class="paragraph">
<p>Why do we not need <code>UserDetailsService</code>?
The <code>jdbcAuthentication</code> method provides a <code>JdbcUserDetailsManagerConfigurer</code> object, which does the same thing as <code>UserDetailsService</code> and lets us connect to a database.
<code>AuthenticationManagerBuilder.jdbcAuthentication</code> is the heart of this example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="recipe-securing-an-angular-web-application">4. Recipe: Securing an Angular Web Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous recipes, we showed how to secure a simple web application.
However, many web applications do not work in such a simple fashion.
Many web applications separate the front end from the back end by using one or more libraries to develop the front end.
One of the more popular of those libraries is Angular.
This section shows how to use Spring Security to secure an Angular application (with a Spring Boot application as the back end).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For this section, we adapted <a href="https://spring.io/guides/tutorials/spring-security-and-angular-js/">Dave Syer&#8217;s Spring Boot with Angular tutorial</a>.
That tutorial offers more detail, including tests.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this guide, we work through the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#angular-create-spring-boot-application">Create a Spring Boot Application</a></p>
</li>
<li>
<p><a href="#angular-create-angular-application">Create an Angular Application</a></p>
</li>
<li>
<p><a href="#angular-customize-angular-application">Customize the Angular Application</a></p>
</li>
<li>
<p><a href="#angular-adding-dynamic-content">Adding Dynamic Content</a></p>
</li>
<li>
<p><a href="#angular-how-it-works">How it Works</a></p>
</li>
<li>
<p><a href="#angular-adding-form-based-login">Adding Form-based Login</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="angular-create-spring-boot-application">4.1. Create a Spring Boot Application</h3>
<div class="paragraph">
<p>To get started, you need to create a Spring Boot Application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <a href="https://start.spring.io" class="bare">https://start.spring.io</a> (the Spring Initializr).</p>
</li>
<li>
<p>Change the artifact for your application whatever you like.
(We use <code>spring-security-angular</code> and leave the group as <code>com.example</code>).</p>
</li>
<li>
<p>Add the Spring Security and Spring Web dependencies.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you want to use Maven, the following link has all the settings described in the preceding process:
<a href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=2.3.3.RELEASE&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=com.example&amp;artifactId=spring-security-angular%20&amp;name=spring-security-angular%20&amp;description=Demo%20project%20for%20Spring%20Boot&amp;packageName=com.example.spring-security-angular%20&amp;dependencies=security,web" class="bare">https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=2.3.3.RELEASE&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=com.example&amp;artifactId=spring-security-angular%20&amp;name=spring-security-angular%20&amp;description=Demo%20project%20for%20Spring%20Boot&amp;packageName=com.example.spring-security-angular%20&amp;dependencies=security,web</a></p>
</div>
<div class="paragraph">
<p>For Gradle, the link is as follows:
<a href="https://start.spring.io/#!type=gradle-project&amp;language=java&amp;platformVersion=2.3.3.RELEASE&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=com.example&amp;artifactId=spring-security-angular%20&amp;name=spring-security-angular%20&amp;description=Demo%20project%20for%20Spring%20Boot&amp;packageName=com.example.spring-security-angular%20&amp;dependencies=security,web" class="bare">https://start.spring.io/#!type=gradle-project&amp;language=java&amp;platformVersion=2.3.3.RELEASE&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=com.example&amp;artifactId=spring-security-angular%20&amp;name=spring-security-angular%20&amp;description=Demo%20project%20for%20Spring%20Boot&amp;packageName=com.example.spring-security-angular%20&amp;dependencies=security,web</a></p>
</div>
</div>
<div class="sect2">
<h3 id="angular-create-angular-application">4.2. Create an Angular Application</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For this section, we adapted <a href="https://github.com/dsyer/spring-boot-angular">Dave Syer&#8217;s Spring Boot with Angular sample</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Developing an Angular application is sufficiently complex that we have moved it into its own section.
If you are comfortable with Angular, you can probably skip it.
If you are new to Angular, you should probably read it before reading the rest of this recipe.</p>
</div>
<div class="sect3">
<h4 id="angular-customize-angular-application">4.2.1. Customize the Angular Application</h4>
<div class="paragraph">
<p>Now we can customize the Angular application. To do so, we need to modify the <code>app.component.ts</code> file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Component } from '@angular/core';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent {
  title = 'Demo';
  greeting = {'id': 'XXX', 'content': 'Hello World'};
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We also need to modify the corresponding HTML file (<code>app.component.html</code>):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div style="text-align:center"class="container"&gt;
  &lt;h1&gt;
    Welcome {{title}}!
  &lt;/h1&gt;
  &lt;div class="container"&gt;
    &lt;p&gt;Id: &lt;span&gt;{{greeting.id}}&lt;/span&gt;&lt;/p&gt;
    &lt;p&gt;Message: &lt;span&gt;{{greeting.content}}!&lt;/span&gt;&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now the application shows a greeting.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="angular-adding-dynamic-content">4.3. Adding Dynamic Content</h3>
<div class="paragraph">
<p>So far, the greeting has been hard-coded.
Most web applications need more functionality than that, so we need to add some dynamic content.
We start by adjusting the Java application class (<code>UiApplication.java</code>):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SpringBootApplication
@RestController
public class UiApplication {

  @RequestMapping("/resource")
  public Map&lt;String,Object&gt; home() {
    Map&lt;String,Object&gt; model = new HashMap&lt;String,Object&gt;();
    model.put("id", UUID.randomUUID().toString());
    model.put("content", "Hello World");
    return model;
  }

  public static void main(String[] args) {
    SpringApplication.run(UiApplication.class, args);
  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>/resource</code> endpoint is secure by default.
If you <code>curl</code> to it, you can see that it is secure, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl localhost:8080/resource
{"timestamp":1420442772928,"status":401,"error":"Unauthorized","message":"Full authentication is required to access this resource","path":"/resource"}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_loading_a_dynamic_resource_with_angular">4.4. Loading a Dynamic Resource with Angular</h3>
<div class="paragraph">
<p>We want to show that security message in the browser.
To do so, we need to modify both <code>app.component.ts</code> and <code>app.module.ts</code>.
The following listing shows the updated <code>app.component.ts</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Component } from '@angular/core';
import { HttpClient } from '@angular/common/http';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent {
  title = 'Demo';
  greeting = {};
  constructor(private http: HttpClient) {
    http.get('resource').subscribe(data =&gt; this.greeting = data); <b class="conum">(1)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Do a GET against the <code>resource</code> endpoint.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>The following listing shows the updated <code>app.module.ts</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';

import { AppComponent } from './app.component';
import { HttpClientModule } from '@angular/common/http';

@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    HttpClientModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you run the application again (or refresh the page in your browser), you can see the dynamic greeting and its unique ID.</p>
</div>
</div>
<div class="sect2">
<h3 id="angular-how-it-works">4.5. How it Works</h3>
<div class="paragraph">
<p>If you use the developer tools that are available in some browsers (such as those you see when you press F12 in Chrome), you
can see the interaction between the server and your browser as it readies the application.
The following table shows what happens:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Application-browser Interaction</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong>Verb</strong></th>
<th class="tableblock halign-center valign-top"><strong>Path</strong></th>
<th class="tableblock halign-center valign-top"><strong>Status</strong></th>
<th class="tableblock halign-center valign-top"><strong>Response</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>401</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser prompts for authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>200</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index.html</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/*.js</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>200</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads of third assets from angular</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/main.bundle.js</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>200</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application logic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/resource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>200</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON greeting</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="angular-adding-form-based-login">4.6. Adding Form-based Login</h3>
<div class="paragraph">
<p>In the <a href="#angular-create-angular-application">Create an Angular Application</a> section, we create a simple Angular application with Spring Boot as its backend.
The trouble is that it is not as attractive as it could be and (much more importantly for our purposes) not as secure as it could be.
In particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Basic authentication is restricted to username and password authentication.</p>
</li>
<li>
<p>The authentication UI is ugly (a browser dialog).</p>
</li>
<li>
<p>There is no protection from Cross Site Request Forgery (CSRF).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can solve those problems by adding form-based login and securing it with Spring Security.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you are working through this section with the sample application, be sure to clear your browser cache of cookies and HTTP Basic credentials.
In Chrome, the best way to do that for a single server is to open a new incognito window.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_adding_navigation_to_the_home_page">4.6.1. Adding Navigation to the Home Page</h4>
<div class="paragraph">
<p>For form-based login to make sense, we need to add some simple navigation to our application.
We want to add <strong>Login</strong>, <strong>Logout</strong>, and <strong>Home</strong> buttons.
We can do that in <code>app.component.html</code>, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div class="container"&gt;
  &lt;ul class="nav nav-pills"&gt;
    &lt;li&gt;&lt;a routerLinkActive="active" routerLink="/home"&gt;Home&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a routerLinkActive="active" routerLink="/login"&gt;Login&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a (click)="logout()"&gt;Logout&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;
&lt;div class="container"&gt;
  &lt;router-outlet&gt;&lt;/router-outlet&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now we have a navigation container with our three options.
We can style these three elements as we wish, which gives us much more flexibility than a dialog box and the ability to make a much more attractive application.</p>
</div>
<div class="paragraph">
<p>We also defined a container that holds a <code>&lt;router-outlet/&gt;</code> element.
Angular provides the <code>&lt;router-outlet/&gt;</code> element to let us put the content from various routes in that container.
We need to wire it to a component in the main module. We need one component per route (that is, per menu link), a helper service to glue them together, and the ability to share state (through <code>AppService</code>).</p>
</div>
<div class="paragraph">
<p>A new version of <code>app.module.ts</code> can do all that for us:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { HttpClientModule } from '@angular/common/http';
import { RouterModule, Routes } from '@angular/router';
import { AppService } from './app.service';
import { HomeComponent } from './home.component';
import { LoginComponent } from './login.component';
import { AppComponent } from './app.component';

const routes: Routes = [
  { path: '', pathMatch: 'full', redirectTo: 'home'},
  { path: 'home', component: HomeComponent},
  { path: 'login', component: LoginComponent}
];

@NgModule({
  declarations: [
    AppComponent,
    HomeComponent,
    LoginComponent
  ],
  imports: [
    RouterModule.forRoot(routes),
    BrowserModule,
    HttpClientModule,
    FormsModule
  ],
  providers: [AppService]
  bootstrap: [AppComponent]
})
export class AppModule { }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A dependency on the Angular <code>RouterModule</code> module lets us inject a router into the constructor of the <code>AppComponent</code>.
We use the routes inside of the imports of the <code>AppModule</code> to set up links to <code>/</code> (the &#8220;home&#8221; controller) and <code>login</code> (the &#8220;login&#8221; controller).</p>
</div>
<div class="paragraph">
<p>We also included <code>FormsModule</code>, because we need it later to bind data to a form.</p>
</div>
<div class="paragraph">
<p>The UI components are all &#8220;declarations&#8221;, and the service glue is a &#8220;provider&#8221;.
The <code>AppComponent</code> does not really do much.
The following listing shows the TypeScript component that goes with the application root:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Component } from '@angular/core';
import { AppService } from './app.service';
import { HttpClient } from '@angular/common/http';
import { Router } from '@angular/router';
import 'rxjs/add/operator/finally';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent {
  constructor(private app: AppService, private http: HttpClient, private router: Router) {
      this.app.authenticate(undefined, undefined);
    }
    logout() {
      this.http.post('logout', {}).finally(() =&gt; {
          this.app.authenticated = false;
          this.router.navigateByUrl('/login');
      }).subscribe();
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Consider the following features of the preceding listing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is some more dependency injection, this time of the <code>AppService</code>.</p>
</li>
<li>
<p>There is a logout function exposed as a property of the component.
Later, we can use it to send a logout request to the backend.
It sets a flag in the app service and sends the user back to the login screen (it does so unconditionally in a finally() callback).</p>
</li>
<li>
<p>We use <code>templateUrl</code> to externalize the template HTML into a separate file.</p>
</li>
<li>
<p>The <code>authenticate()</code> function is called when the controller is loaded, to see if the user is actually already authenticated (for example, if he had refreshed the browser in the middle of a session).
We need the <code>authenticate()</code> function to make a remote call, because the actual authentication is done by the server, and we do not trust the browser to keep track of it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>app</code> service that we injected needs a boolean flag so that we can tell if the user is currently authenticated.
It also needs a function called <code>authenticate()</code> that we can use to authenticate with the backend server or to query for the user details.
The following listing shows <code>app.service.ts</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';

@Injectable()
export class AppService {

  authenticated = false;

  constructor(private http: HttpClient) {
  }

  authenticate(credentials, callback) {

        const headers = new HttpHeaders(credentials ? {
            authorization : 'Basic ' + btoa(credentials.username + ':' + credentials.password)
        } : {});

        this.http.get('user', {headers: headers}).subscribe(response =&gt; {
            if (response['name']) {
                this.authenticated = true;
            } else {
                this.authenticated = false;
            }
            return callback &amp;&amp; callback();
        });

    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If HTTP Basic authentication credentials are provided, the <code>authenticate()</code> function sends them.
Otherwise, it does not.
It also has an optional <code>callback</code> argument that we can use to run some code if the authentication is successful.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_the_greeting">4.7. Setting up the Greeting</h3>
<div class="paragraph">
<p>The greeting content from the previous home page can go right next to <code>app.component.html</code> in <code>src/app</code>, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;h1&gt;Greeting&lt;/h1&gt;
&lt;div [hidden]="!authenticated()"&gt;
	&lt;p&gt;The ID is {{greeting.id}}&lt;/p&gt;
	&lt;p&gt;The content is {{greeting.content}}&lt;/p&gt;
&lt;/div&gt;
&lt;div [hidden]="authenticated()"&gt;
	&lt;p&gt;Login to see your greeting&lt;/p&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Since the user now has a choice of whether to login or not (before, it was all controlled by the browser), we need to distinguish in the UI between content that is secure and content that is not.
We have anticipated this by adding references to an (as yet non-existent) <code>authenticated()</code> function.</p>
</div>
<div class="paragraph">
<p>The <code>HomeComponent</code> has to fetch the greeting and provide the <code>authenticated()</code> utility function that pulls the flag out of the AppService.
The following listing shows <code>home.component.ts</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Component, OnInit } from '@angular/core';
import { AppService } from './app.service';
import { HttpClient } from '@angular/common/http';

@Component({
  templateUrl: './home.component.html'
})
export class HomeComponent {

  title = 'Demo';
  greeting = {};

  constructor(private app: AppService, private http: HttpClient) {
    http.get('resource').subscribe(data =&gt; this.greeting = data);
  }

  authenticated() { return this.app.authenticated; }

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_the_login_form">4.8. Setting up the Login Form</h3>
<div class="paragraph">
<p>The login form also gets its own component (in <code>login.component.html</code>), as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div class="alert alert-danger" [hidden]="!error"&gt;
	There was a problem logging in. Please try again.
&lt;/div&gt;
&lt;form role="form" (submit)="login()"&gt;
	&lt;div class="form-group"&gt;
		&lt;label for="username"&gt;Username:&lt;/label&gt; &lt;input type="text"
			class="form-control" id="username" name="username" [(ngModel)]="credentials.username"/&gt;
	&lt;/div&gt;
	&lt;div class="form-group"&gt;
		&lt;label for="password"&gt;Password:&lt;/label&gt; &lt;input type="password"
			class="form-control" id="password" name="password" [(ngModel)]="credentials.password"/&gt;
	&lt;/div&gt;
	&lt;button type="submit" class="btn btn-primary"&gt;Submit&lt;/button&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This login form shares a common structure with a lot of Angular login forms.
It has two inputs (username and password) and a button that submits the form to an Angular event handler.
We do not need an action on the form tag, so it is probably better not to put one in at all.
There is also an error message, shown only if the angular model contains an error.
The form controls use <code>ngModel</code> (from the Angular Forms module) to pass data between the HTML and the Angular controller.
In this case, we use a credentials object to hold the username and password.</p>
</div>
</div>
<div class="sect2">
<h3 id="_supporting_the_authentication_process">4.9. Supporting the Authentication Process</h3>
<div class="paragraph">
<p>To support the login form, we need to add some more features.
On the client side, these are implemented in the login component.
On the server, it is defined in the Spring Security configuration.</p>
</div>
<div class="sect3">
<h4 id="_submitting_the_login_form">4.9.1. Submitting the Login Form</h4>
<div class="paragraph">
<p>To submit the form, we need to define the <code>login()</code> function that we referenced (in the form) with <code>ng-submit</code> and the credentials object that we referenced with <code>ng-model</code>.
Now we can flesh out the &#8220;login&#8221; component, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Component, OnInit } from '@angular/core';
import { AppService } from './app.service';
import { HttpClient } from '@angular/common/http';
import { Router } from '@angular/router';

@Component({
  templateUrl: './login.component.html'
})
export class LoginComponent {

  credentials = {username: '', password: ''};

  constructor(private app: AppService, private http: HttpClient, private router: Router) {
  }

  login() {
    this.app.authenticate(this.credentials, () =&gt; {
        this.router.navigateByUrl('/');
    });
    return false;
  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition to initializing the credentials object, it defines the <code>login()</code> function that we need in the form.</p>
</div>
<div class="paragraph">
<p>The <code>authenticate()</code> call makes a <code>GET</code> request to a relative resource (relative to the deployment root of your application): <code>/user</code>.
When called from the <code>login()</code> function, it adds the Base64-encoded credentials in the headers so that, on the server, it does an authentication and accepts a cookie in return.
The <code>login()</code> function also sets a local <code>$scope.error</code> flag accordingly when we get the result of the authentication.
This flag is used to control the display of the error message above the login form.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_the_user_endpoint">4.9.2. Adding the <code>/user</code> Endpoint</h4>
<div class="paragraph">
<p>To service the <code>authenticate()</code> function, we need to add a new endpoint to the backend, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SpringBootApplication
@RestController
public class UiApplication {

  @RequestMapping("/user")
  public Principal user(Principal user) {
    return user;
  }

  // The rest of the class...

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This code demonstrates a useful trick that you can use in a Spring Security application.
If the <code>/user</code> resource is reachable, it returns the currently authenticated user (an <code>Authentication</code>).
Otherwise, Spring Security intercepts the request and sends a 401 response through an <code>AuthenticationEntryPoint</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_handling_the_login_request_on_the_server">4.9.3. Handling the Login Request on the Server</h4>
<div class="paragraph">
<p>Spring Security makes it easy to handle the login request.
We need to add some configuration to our main application class.
In this case, we add it as an inner class:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SpringBootApplication
@RestController
public class UiApplication {

  // The rest of the class...

  @Configuration
  @Order(SecurityProperties.ACCESS_OVERRIDE_ORDER)
  protected static class SecurityConfiguration extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception {
      http
        .httpBasic()
      .and()
        .authorizeRequests()
          .antMatchers("/index.html", "/", "/home", "/login").permitAll()
          .anyRequest().authenticated();
    }
  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is a standard Spring Boot application with Spring Security customization.
It allows anonymous access to the static (HTML) resources.
The HTML resources need to be available to anonymous users, rather than being ignored by Spring Security, for reasons that we cover soon.</p>
</div>
<div class="paragraph">
<p>The last thing we need to remember is to make the JavaScript components provided by Angular available anonymously to the application.
We could do that in the <code>HttpSecurity</code> configuration (in the preceding listing)
However, since it is static content, it is better to ignore it.
We can do so with a bit of configuration in our <code>application.yml</code> file, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">	security:
		ignored:
		- "*.bundle.*"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_default_http_request_headers">4.9.4. Adding Default HTTP Request Headers</h4>
<div class="paragraph">
<p>If you run the application at this point, the browser pops up a Basic authentication dialog (for the username and password).
It does so because it sees a 401 response from the XHR requests to <code>/user</code> and <code>/resource</code> with a <code>WWW-Authenticate</code> header.
To suppress this popup, suppress the header, which comes from Spring Security.
The way to suppress the response header is to send a special, conventional request header named <code>X-Requested-With=XMLHttpRequest</code>. (It used to be the default in Angular, but they took it out in 1.3.0.)
So here is how to set default headers in an Angular XHR request.</p>
</div>
<div class="paragraph">
<p>First, we need to extend the default <code>RequestOptions</code> provided by the Angular HTTP module in <code>app.module.ts</code>, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">@Injectable()
export class XhrInterceptor implements HttpInterceptor {

  intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler) {
    const xhr = req.clone({
      headers: req.headers.set('X-Requested-With', 'XMLHttpRequest')
    });
    return next.handle(xhr);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The syntax here is boilerplate.
The <code>implements</code> property of the <code>Class</code> is its base class.
Also, in addition to the constructor, we need to override the <code>intercept()</code> function, which is always called by Angular and can be used to add additional headers.</p>
</div>
<div class="paragraph">
<p>To install this new <code>RequestOptions</code> factory, we need to declare it in the providers of the AppModule (in <code>app.module.ts</code>), as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">@NgModule({
  ...
  providers: [AppService, { provide: HTTP_INTERCEPTORS, useClass: XhrInterceptor, multi: true }],
  ...
})
export class AppModule { }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_logout">4.9.5. Implementing Logout</h4>
<div class="paragraph">
<p>The application is almost finished, at least functionally.
(We are not concerned with appearance in this guide.)
The last thing we need to do is implement the logout feature that we sketched in the home page.
If the user is authenticated, we show a &#8220;Logout&#8221; link and hook it to a <code>logout()</code> function in the <code>AppComponent</code>.
Remember, it sends an HTTP POST to <code>/logout</code> which we now need to implement on the server.
This is straightforward because, it is added for us already by Spring Security (that is, we need not do anything for this simple use case).
For more control over the logout behavior, you could use the HttpSecurity callbacks in your <code>WebSecurityAdapter</code> to, for instance, run some business logic after logout.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_csrf_protection">4.9.6. Adding CSRF Protection</h4>
<div class="paragraph">
<p>The application is almost ready to use.
If you run it, you can see that everything we built so far actually works, except for the &#8220;Logout&#8221; link.
Try using it and look at the responses in the browser to see why it is not yet finished.
You should see something similar to the following listing:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>POST /logout HTTP/1.1
...
Content-Type: application/x-www-form-urlencoded

username=user&amp;password=password

HTTP/1.1 403 Forbidden
Set-Cookie: JSESSIONID=3941352C51ABB941781E1DF312DA474E; Path=/; HttpOnly
Content-Type: application/json;charset=UTF-8
Transfer-Encoding: chunked
...

{"timestamp":1420467113764,"status":403,"error":"Forbidden","message":"Expected CSRF token not found. Has your session expired?","path":"/login"}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Getting this response is a good sign, because it means that Spring Security’s built-in CSRF protection is working.
It wants to find a token in a header called <code>X-CSRF</code>.
The value of the CSRF token was available server side in the <code>HttpRequest</code> attributes from the initial request that loaded the home page.
To get it to the client, we could render it by using a dynamic HTML page on the server, expose it through a custom endpoint, or send it as a cookie.
The last choice is best, because Angular has built-in support for CSRF (which it calls &#8220;XSRF&#8221;) based on cookies.</p>
</div>
<div class="paragraph">
<p>On the server, we need a custom filter to send the cookie.
Angular wants the cookie name to be <code>XSRF-TOKEN</code>, and Spring Security provides it as a request attribute by default, so we only need to transfer the value from a request attribute to a cookie.
Fortunately, Spring Security (since version 4.1.0) provides a special <code>CsrfTokenRepository</code> that does precisely what we need.
The following listing shows how to use it:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@Order(SecurityProperties.ACCESS_OVERRIDE_ORDER)
protected static class SecurityConfiguration extends WebSecurityConfigurerAdapter {
  @Override
  protected void configure(HttpSecurity http) throws Exception {
    http
      // The other security setup details...
      .and().csrf()
        .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We need not do anything on the client side, and the login form now works.</p>
</div>
</div>
<div class="sect3">
<h4 id="angular-how-it-works-login-form">4.9.7. How It Works</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Application-browser Interaction</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong>Verb</strong></th>
<th class="tableblock halign-center valign-top"><strong>Path</strong></th>
<th class="tableblock halign-center valign-top"><strong>Status</strong></th>
<th class="tableblock halign-center valign-top"><strong>Response</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index.html</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/*.js</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assets from angular</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unauthorized (ignored)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/home</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Home page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unauthorized (ignored)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unauthorized (ignored)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send credentials and get JSON</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON greeting</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The responses that are marked &#8220;ignored&#8221; are HTML responses received by Angular in an XHR call.
Since we are not processing that data, the HTML is dropped.
We do look for an authenticated user in the case of the <code>/user</code> resource.
However, since it is not present in the first call, that response is dropped.</p>
</div>
<div class="paragraph">
<p>Look more closely at the requests, and you can see that they all have cookies.
If you start with a clean browser (for example, by using incognito mode in Chrome), the very first request has no cookies going off to the server, but the server sends back <code>Set-Cookie</code> for <code>JSESSIONID</code> (the regular <code>HttpSession</code>) and <code>X-XSRF-TOKEN</code> (the CRSF cookie that we set up earlier).
Subsequent requests all have those cookies, and they are important.
The application does not work without them, and they provide some basic security features (authentication and CSRF protection).
The values of the cookies change when the user authenticates (after the <code>POST</code>) and this is another important security feature (preventing <a href="https://en.wikipedia.org/wiki/Session_fixation">session fixation attacks</a>).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
It is not adequate for CSRF protection to rely on a cookie being sent back to the server, because the browser automatically sends it, even if you are not in a page loaded from your application (a Cross Site Scripting attack, otherwise known as <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">XSS</a>).
The header is not automatically sent, so the origin is under control.
You might see that, in our application, the CSRF token is sent to the client as a cookie, so we see it being sent back automatically by the browser, but it is the header that provides the protection.
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Application Scaling</div>
<div class="paragraph">
<p>&#8220;But wait,&#8221; you might say, &#8220;isn’t it Really Bad to use session state in a single-page application?&#8221;
The answer to that question is going to have to be &#8220;mostly&#8221;, because it very definitely is a Good Thing to use the session for authentication and CSRF protection.
That state has to be stored somewhere, and, if you take it out of the session, you are going to have to put it somewhere else and manage it manually yourself, on both the server and the client.
That means more code and probably more maintenance and generally re-inventing a perfectly good wheel.</p>
</div>
<div class="paragraph">
<p>&#8220;But, but,&#8221; you may respond, &#8220;how do I scale my application horizontally now?&#8221;
This is the &#8220;real&#8221; question you were asking above, but it tends to get shortened to "Session state is bad; I must be stateless". Do not panic.
Security is stateful.
You cannot have a secure, stateless application.
So where are you going to store the state?
That is all there is to it.
<a href="https://spring.io/team/rwinch">Rob Winch</a> gave a very useful and insightful talk at <a href="https://skillsmatter.com/skillscasts/5398-the-state-of-securing-restful-apis-with-spring">Spring Exchange 2014</a>, in which he explained the need for state (and the ubiquity of it&#8201;&#8212;&#8201;TCP and SSL are stateful, so your system is stateful whether you knew it or not), which is probably worth a look if you want to look into this topic in more depth.</p>
</div>
<div class="paragraph">
<p>The good news is that you have a choice.
The easiest choice is to store the session data in-memory and rely on sticky sessions in your load balancer to route requests from the same session back to the same JVM (they all support that in some way).
That is good enough to get you off the ground and works for a really large number of use cases.
The other choice is to share the session data between instances of your application.
As long as you are strict and store only the security data, it is small and changes infrequently (only when users log in and out or when their session times out), so there should not be any major infrastructure problems.
It is also really easy to do with <a href="https://github.com/spring-projects/spring-session/">Spring Session</a>.
It is literally a few lines of code and a Redis server, which is super fast.</p>
</div>
<div class="paragraph">
<p>Another easy way to set up shared session state is to deploy your application as a WAR file to Cloud Foundry <a href="https://run.pivotal.io/">Pivotal Web Services</a> and bind it to a Redis service.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="recipe-securing-a-client-application-with-oauth">5. Recipe: Securing a Client Application with OAuth</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to create an OAuth client application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We use &#8220;OAuth&#8221; and &#8220;OAuth2&#8221; interchangeably. Spring Security has moved away from the first version of OAuth.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="understanding-oauth">5.1. Understanding OAuth</h3>
<div class="paragraph">
<p>Another way to secure an application is with OAuth. According to one <a href="https://oauth.net/">OAuth web site</a>, OAuth is &#8220;An open protocol to allow secure authorization in a simple and standard method from web, mobile and desktop applications.&#8221;</p>
</div>
<div class="paragraph">
<p>To understand OAuth, you should first understand the difference between authentication and authorization.
Authentication is the process of proving that someone is who they say they are.
Authentication is typically done with a login screen that prompts for a user name and password (though it can be done by other means, such as fingerprint readers).
Authorization is the process of granting permission to do something.
Authorization does not (with one notable exception, which we cover later in this section) involve authentication.</p>
</div>
<div class="paragraph">
<p>In the typical OAuth authorization scenario, a third-party application wants authorization to do some action on another application, and it wants authorization to do whatever that action may be.
Consider the following common scenario. An application wants to add content (perhaps news about a certain subject) to your Facebook feed.
The application that wants to add news stories is the third-party application, and the end user can authorize Facebook to let that happen.
In this scenario (and many similar scenarios), we see three roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User: The person who wants to get news stories added to their Facebook page.</p>
</li>
<li>
<p>Client: The third-party application that has the news stories.</p>
</li>
<li>
<p>Resource Server: Facebook&#8217;s API that can grant authorization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another part of the process is the authorization server, which is the resource server&#8217;s user interface that lets the Facebook user say OK to those news stories being added.
For small applications, the resource server and the authentication server may be the same thing. For larger applications, the authorization server is a separate application.</p>
</div>
<div class="paragraph">
<p>To make things more clear, consider the flow of actions in the process to which we have so far alluded in this section:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The user finds a web application that offers to add news stories to their Facebook page and thinks that is a fine idea.</p>
</li>
<li>
<p>The user clicks a button to make that happen.</p>
</li>
<li>
<p>The news application (the client in this scenario) redirects to Facebook&#8217;s authorization server.
The user may have to log in to the resource server (Facebook, in this case) at this point, to verify their identity.</p>
</li>
<li>
<p>The user clicks an Accept (or similar) button to tell Facebook to grant permission to the news application.</p>
</li>
<li>
<p>The user returns to the news application, which now has permission to add news stories to the user&#8217;s Facebook page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The whole process is not complicated, but it is substantially different than the security scenarios we have covered in other recipes, notably logging in may not be required.
Again, we deal with authorization rather than authentication.</p>
</div>
<div class="sect3">
<h4 id="_oauth_and_redirect_uris">5.1.1. OAuth and Redirect URIs</h4>
<div class="paragraph">
<p>OAuth applications do not accept redirects from just anywhere.
Before such a redirect can work, the third-party (client) application must register with the resource server application (Facebook in our example).
Then the resource server knows that redirects from the client application are OK.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_client_id_and_the_secret">5.1.2. The Client ID and the Secret</h4>
<div class="paragraph">
<p>When the user in the example we described earlier authorizes the client (the news service in our example), the resource server (Facebook in our example) sends a client ID to the client and may also send a secret to the client.
The client ID is public and identifies the user for the client application (the news service).
The secret (if it is sent) makes it easy for the client to complete transactions (sending news stories to the user&#8217;s Facebook page).</p>
</div>
<div class="sect4">
<h5 id="_when_to_not_send_secrets">When to Not Send Secrets</h5>
<div class="paragraph">
<p>If the client cannot keep a secret, the resource server should not send a secret.
That happens for single-page web applications (such as the Angular application from the <a href="#recipe-securing-an-angular-web-application">Recipe: Securing an Angular Web Application</a> recipe) and for mobile applications.
Because bad actors can get the secret in those situations, the resource server should not send a secret to mobile and single-page applications.</p>
</div>
<div class="paragraph">
<p>Instead, the resource server and client can use a secret that is generated for each request.
One standard for doing so is <a href="https://oauth.net/2/pkce/">PKCE</a> (Proof Key for Code Exchange).
PKCE exists &#8220;to prevent certain attacks and to be able to securely perform the OAuth exchange from public clients.&#8221;</p>
</div>
<div class="paragraph">
<p>For the resource server, the trick is knowing when to send a secret and when to use PKCE.
This can be determined when the client registers with the resource server.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_the_client_application">5.2. Writing the Client Application</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This section, including the application, was adapted from a Spring Security example at <a href="https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2login" class="bare">https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2login</a>. You can find many other Spring Security examples in the project that contains this application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To create a client application that accesses Facebook, you must:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#oauth-adding-a-new-application">Add a new application</a></p>
</li>
<li>
<p>Configure application.yml</p>
</li>
<li>
<p>Boot up the application</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="oauth-adding-a-new-application">5.2.1. Adding a New Application</h4>
<div class="paragraph">
<p>To use Facebook’s OAuth 2.0 authentication system for login, you must first <a href="https://developers.facebook.com/apps">Add a New App</a>.</p>
</div>
<div class="paragraph">
<p>To do so from Facebook&#8217;s New App page:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select <strong>Create a New App</strong></p>
<div class="paragraph">
<p>The "Create a New App ID" page appears.</p>
</div>
</li>
<li>
<p>Enter the <strong>Display Name</strong>, <strong>Contact Email</strong>, and <strong>Category</strong></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The selection for the <strong>Category</strong> field is not relevant, but the field is requred. Select "Local" for its value.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Create App ID</strong>.</p>
<div class="paragraph">
<p>The next page to appear is "Product Setup".</p>
</div>
</li>
<li>
<p>Click the <strong>Get Started</strong> button for the Facebook Login product.</p>
</li>
<li>
<p>In the left sidebar, under <strong>Products → Facebook Login</strong>, select <strong>Settings</strong>.</p>
</li>
<li>
<p>For the field Valid OAuth redirect URIs, enter <code><a href="http://localhost:8080/login/oauth2/code/facebook" class="bare">http://localhost:8080/login/oauth2/code/facebook</a></code>.</p>
<div class="paragraph">
<p>For a real application, you would almost certainly have a URI that did not use <code>localhost</code>.
However the sample shown in this recipe uses localhost, so that you can run it locally.</p>
</div>
</li>
<li>
<p>Click <strong>Save Changes</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The OAuth redirect URI is the path in the application that the end-user’s user-agent is redirected back to after they have authenticated with Facebook and have granted access to the application on the Authorize application page.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The default redirect URI template is <code>{baseUrl}/login/oauth2/code/{registrationId}</code>. The <code>registrationId</code> is a unique identifier for the <code>ClientRegistration</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If the application runs behind a proxy server, you should check <a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#appendix-proxy-server">Proxy Server Configuration</a> to ensure that the application is correctly configured. Also, see the supported <a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#oauth2Client-auth-code-redirect-uri">URI template variables</a> for <code>redirect-uri</code>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_configuring_the_application_yml">Configuring the <code>application.yml</code></h5>
<div class="paragraph">
<p>Now that you have created a new application with Facebook, you need to configure the sample application to use the application for the authentication flow. To do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <code>application.yml</code> (in the <code>resources</code> directory) and set the following configuration:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>spring:
  security:
    oauth2:
      client:
        registration:	<b class="conum">(1)</b>
          facebook:		<b class="conum">(2)</b>
            client-id: facebook-client-id
            client-secret: facebook-client-secret</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>spring.security.oauth2.client.registration</code> is the base property prefix for OAuth client properties.</p>
</li>
<li>
<p>The base property prefix follows the ID for the <code>ClientRegistration</code>&#8201;&#8212;&#8201;in this case, <code>facebook</code>.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
<li>
<p>Replace the values in the client-id and client-secret property with the OAuth 2.0 credentials you created earlier.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_creating_the_application">Creating the Application</h5>
<div class="paragraph">
<p>The application consists of two small classes: a class with a main method that is annotated with <code>@SpringBootApplication</code> to create a Spring Boot application and an OAuth2 login controller. The following listing shows the application class:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package sample;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * @author Joe Grandja
 */
@SpringBootApplication
public class OAuth2LoginApplication {

	public static void main(String[] args) {
		SpringApplication.run(OAuth2LoginApplication.class, args);
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following listing shows the OAuth2 login controller class:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package sample.web;

import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.security.oauth2.client.OAuth2AuthorizedClient;
import org.springframework.security.oauth2.client.annotation.RegisteredOAuth2AuthorizedClient;
import org.springframework.security.oauth2.core.user.OAuth2User;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

/**
 * @author Joe Grandja
 * @author Rob Winch
 */
@Controller
public class OAuth2LoginController {

	@GetMapping("/")
	public String index(Model model,
						@RegisteredOAuth2AuthorizedClient OAuth2AuthorizedClient authorizedClient,
						@AuthenticationPrincipal OAuth2User oauth2User) {
		model.addAttribute("userName", oauth2User.getName());
		model.addAttribute("clientName", authorizedClient.getClientRegistration().getClientName());
		model.addAttribute("userAttributes", oauth2User.getAttributes());
		return "index";
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can find the original source for these classes plus test classes in the Spring Security samples at <a href="https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2login" class="bare">https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2login</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_oauth_resources">5.3. OAuth Resources</h3>
<div class="paragraph">
<p>OAuth2 is defined by <a href="https://tools.ietf.org/html/rfc6749">IETF RFC (Request for Comment) 6749</a>.
Two highly regarded and closely related web sites offer more detail.
Those sites are <a href="https://oauth.net/" class="bare">https://oauth.net/</a> and <a href="https://oauth.com/" class="bare">https://oauth.com/</a>.
<a href="https://oauth.net/" class="bare">https://oauth.net/</a> is organized as a wiki. <a href="https://oauth.com/" class="bare">https://oauth.com/</a> is organized as a book.
Both are worth reading if you need to understand OAuth2 in depth.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="recipe-creating-an-oauth-resource-server">6. Recipe: Creating an OAuth Resource Server</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We use "OAuth" and "OAuth2" interchangeably. Spring Security has moved away from the first version of OAuth.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous recipe, <a href="#oauth-client-recipe">[oauth-client-recipe]</a>, detailed how to create a client that is secured by OAuth2.
To really understand this recipe, you should probably read the <a href="#understanding-oauth">Understanding OAuth</a> section within that recipe.
This recipe describes how to create an OAuth2 Resource Server.</p>
</div>
<div class="paragraph">
<p>According to the <a href="https://tools.ietf.org/html/rfc6749">RFC that defines OAuth2</a>, "In OAuth, the client requests access to resources controlled by the resource owner and hosted by the resource server."
In other words, <a href="https://www.oauth.com/oauth2-servers/the-resource-server/">as the folks at oauth.com write</a>, an OAuth2 "resource server handles authenticated requests after the application has obtained an access token."</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The code and much of the description for this recipe comes from the Spring Security samples at <a href="https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2resourceserver" class="bare">https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2resourceserver</a>.
You can find many other <a href="https://github.com/spring-projects/spring-security/tree/master/samples">Spring Security samples</a> in that project.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_oauth_resources_2">6.1. OAuth Resources</h3>
<div class="paragraph">
<p>OAuth2 is defined by <a href="https://tools.ietf.org/html/rfc6749">IETF RFC (Request for Comment) 6749</a>.
Two highly regarded and closely related web sites offer more detail.
Those sites are <a href="https://oauth.net/" class="bare">https://oauth.net/</a> and <a href="https://oauth.com/" class="bare">https://oauth.com/</a>.
<a href="https://oauth.net/" class="bare">https://oauth.net/</a> is organized as a wiki. <a href="https://oauth.com/" class="bare">https://oauth.com/</a> is organized as a book.
Both are worth reading if you need to understand OAuth2 in depth.</p>
</div>
</div>
<div class="sect2">
<h3 id="_writing_the_resource_server">6.2. Writing the Resource Server</h3>
<div class="paragraph">
<p>To begin, you need a build file. In this case, we use a <code>build.gradle</code> file, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">apply plugin: 'io.spring.convention.spring-sample-boot'

dependencies {
	compile project(':spring-security-config')
	compile project(':spring-security-oauth2-jose')
	compile project(':spring-security-oauth2-resource-server')

	compile 'org.springframework.boot:spring-boot-starter-web'
	compile 'com.squareup.okhttp3:mockwebserver'

	testCompile project(':spring-security-test')
	testCompile 'org.springframework.boot:spring-boot-starter-test'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then you can create a Spring Boot application class, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package sample;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * @author Josh Cummings
 */
@SpringBootApplication
public class OAuth2ResourceServerApplication {

	public static void main(String[] args) {
		SpringApplication.run(OAuth2ResourceServerApplication.class, args);
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The application does nothing until you add more classes.
In this case, we need two more classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OAuth2ResourceServerSecurityConfiguration</code> to hold the configuration.</p>
</li>
<li>
<p><code>OAuth2ResourceServerController</code> to handle requests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following listing shows the <code>OAuth2ResourceServerSecurityConfiguration</code> class:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package sample;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.http.HttpMethod;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.config.annotation.web.configurers.oauth2.server.resource.OAuth2ResourceServerConfigurer;
import org.springframework.security.oauth2.jwt.JwtDecoder;
import org.springframework.security.oauth2.jwt.NimbusJwtDecoder;

/**
 * @author Josh Cummings
 */
@EnableWebSecurity
public class OAuth2ResourceServerSecurityConfiguration extends WebSecurityConfigurerAdapter {

	@Value("${spring.security.oauth2.resourceserver.jwt.jwk-set-uri}") String jwkSetUri;

	@Override
	protected void configure(HttpSecurity http) throws Exception {
		// @formatter:off
		http
			.authorizeRequests((authorizeRequests) -&gt;
				authorizeRequests
					.antMatchers(HttpMethod.GET, "/message/**").hasAuthority("SCOPE_message:read")
					.antMatchers(HttpMethod.POST, "/message/**").hasAuthority("SCOPE_message:write")
					.anyRequest().authenticated()
			)
			.oauth2ResourceServer(OAuth2ResourceServerConfigurer::jwt);
		// @formatter:on
	}

	@Bean
	JwtDecoder jwtDecoder() {
		return NimbusJwtDecoder.withJwkSetUri(this.jwkSetUri).build();
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following listing shows the <code>OAuth2ResourceServerController</code> class:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package sample;

import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.security.oauth2.jwt.Jwt;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

/**
 * @author Josh Cummings
 */
@RestController
public class OAuth2ResourceServerController {

	@GetMapping("/")
	public String index(@AuthenticationPrincipal Jwt jwt) {
		return String.format("Hello, %s!", jwt.getSubject());
	}

	@GetMapping("/message")
	public String message() {
		return "secret message";
	}

	@PostMapping("/message")
	public String createMessage(@RequestBody String message) {
		return String.format("Message was created. Content: %s", message);
	}
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_resource_server">6.3. Running the Resource Server</h3>
<div class="paragraph">
<p>The application class lets you run the resource server with the following command (provided you run it from the directory that holds the build file):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./gradlew bootRun</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once the application is running, you can define a token for it to use, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export TOKEN=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdWJqZWN0IiwiZXhwIjoyMTY0MjQ1ODgwLCJhdXRob3JpdGllcyI6WyJST0xFX1VTRVIiXSwianRpIjoiMDFkOThlZWEtNjc0MC00OGRlLTk4ODAtYzM5ZjgyMGZiNzVlIiwiY2xpZW50X2lkIjoibm9zY29wZXMiLCJzY29wZSI6WyJub25lIl19.VOzgGLOUuQ_R2Ur1Ke41VaobddhKgUZgto7Y3AGxst7SuxLQ4LgWwdSSDRx-jRvypjsCgYPbjAYLhn9nCbfwtCitkymUKUNKdebvVAI0y8YvliWTL5S-GiJD9dN8SSsXUla9A4xB_9Mt5JAlRpQotQSCLojVSKQmjhMpQWmYAlKVjnlImoRwQFPI4w3Ijn4G4EMTKWUYRfrD0-WNT9ZYWBeza6QgV6sraP7ToRB3eQLy2p04cU40X-RHLeYCsMBfxsMMh89CJff-9tn7VDKi1hAGc_Lp9yS9ZaItJuFJTjf8S_vsjVB1nBhvdS_6IED_m_fOU52KiGSO2qL6shxHvg</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then you can use curl to make a request, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl -H "Authorization: Bearer $TOKEN" localhost:8080</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The application responds as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Hello, subject!</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>subject</code> is the value of the <code>sub</code> field in the JWT returned by the Authorization Server.</p>
</div>
<div class="sect3">
<h4 id="_handling_get_requests">6.3.1. Handling GET Requests</h4>
<div class="paragraph">
<p>You can make the resource server handle get request by using a different token.
To do, set the token as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export TOKEN=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdWJqZWN0IiwiZXhwIjoyMTY0MjQ1NjQ4LCJhdXRob3JpdGllcyI6WyJST0xFX1VTRVIiXSwianRpIjoiY2I1ZGMwNDYtMDkyMi00ZGJmLWE5MzAtOGI2M2FhZTYzZjk2IiwiY2xpZW50X2lkIjoicmVhZGVyIiwic2NvcGUiOlsibWVzc2FnZTpyZWFkIl19.Pre2ksnMiOGYWQtuIgHB0i3uTnNzD0SMFM34iyQJHK5RLlSjge08s9qHdx6uv5cZ4gZm_cB1D6f4-fLx76bCblK6mVcabbR74w_eCdSBXNXuqG-HNrOYYmmx5iJtdwx5fXPmF8TyVzsq_LvRm_LN4lWNYquT4y36Tox6ZD3feYxXvHQ3XyZn9mVKnlzv-GCwkBohCR3yPow5uVmr04qh_al52VIwKMrvJBr44igr4fTZmzwRAZmQw5rZeyep0b4nsCjadNcndHtMtYKNVuG5zbDLsB7GGvilcI9TDDnUXtwthB_3iq32DAd9x8wJmJ5K8gmX6GjZFtYzKk_zEboXoQ</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then you can use curl to make a GET request, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl -H "Authorization: Bearer $TOKEN" localhost:8080/message</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The resource server responds as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">secret message</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_handling_post_requests">6.3.2. Handling POST Requests</h4>
<div class="paragraph">
<p>You can make the resource server handle get request by using a different token.
To do, set the token as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export TOKEN=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdWJqZWN0IiwiZXhwIjoyMTY0MjQzOTA0LCJhdXRob3JpdGllcyI6WyJST0xFX1VTRVIiXSwianRpIjoiZGI4ZjgwMzQtM2VlNy00NjBjLTk3NTEtMDJiMDA1OWI5NzA4IiwiY2xpZW50X2lkIjoid3JpdGVyIiwic2NvcGUiOlsibWVzc2FnZTp3cml0ZSJdfQ.USvpx_ntKXtchLmc93auJq0qSav6vLm4B7ItPzhrDH2xmogBP35eKeklwXK5GCb7ck1aKJV5SpguBlTCz0bZC1zAWKB6gyFIqedALPAran5QR-8WpGfl0wFqds7d8Jw3xmpUUBduRLab9hkeAhgoVgxevc8d6ITM7kRnHo5wT3VzvBU8DquedVXm5fbBnRPgG4_jOWJKbqYpqaR2z2TnZRWh3CqL82Orh1Ww1dJYF_fae1dTVV4tvN5iSndYcGxMoBaiw3kRRi6EyNxnXnt1pFtZqc1f6D9x4AHiri8_vpBp2vwG5OfQD5-rrleP_XlIB3rNQT7tu3fiqu4vUzQaEg</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then you can use curl to make a POST request, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl -H "Authorization: Bearer $TOKEN" -d "my message" localhost:8080/message</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The resource server responds as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Message was created. Content: my message</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to see more ways of running this resource server, The <a href="https://github.com/spring-projects/spring-security/tree/master/samples/boot/oauth2resourceserver">Spring Security sample from which this code comes</a> has both integration and unit tests.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-09-28 15:09:53 -0500
</div>
</div>
</body>
</html>